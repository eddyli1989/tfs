# TFS 分布式文件系统测试套件

这个测试套件为TFS分布式文件系统提供了全面的测试工具，包括功能测试、性能测试、并发测试和内存映射测试。测试套件设计为安全运行，避免系统崩溃，并提供详细的测试报告。

## 测试套件组件

### 测试脚本

- **run_all_tests.sh**: 主测试脚本，按安全顺序运行所有测试并生成HTML报告
- **safe_test.sh**: 安全的基本功能测试，逐步测试文件系统功能
- **simple_perf_test.sh**: 简单的性能测试，测量基本文件操作性能
- **full_test.sh**: 全面的功能测试（警告：可能导致系统不稳定）
- **compile_tests.sh**: 编译所有测试程序

### 测试程序

- **mmap_test**: 内存映射功能测试程序
- **concurrent_test**: 并发访问测试程序
- **performance_test**: 全面的性能测试程序

## 安装和准备

在运行测试之前，请确保TFS文件系统内核模块和用户空间守护进程已经编译完成。

```bash
# 编译测试程序
cd tfs_distributed_fs/tests
chmod +x compile_tests.sh
./compile_tests.sh
```

## 运行测试

### 安全测试流程（推荐）

```bash
# 运行所有测试并生成报告
sudo ./run_all_tests.sh
```

这将按照安全的顺序运行测试，并在`test_reports`目录中生成HTML报告。

### 单独运行测试

如果需要单独运行特定测试，可以使用以下命令：

```bash
# 运行安全基本测试
sudo ./safe_test.sh

# 运行简单性能测试
sudo ./simple_perf_test.sh /mnt/tfs_test

# 运行全面功能测试（谨慎使用）
sudo ./full_test.sh
```

## 测试报告解读

HTML测试报告包含以下部分：

1. **测试摘要**：显示通过、失败和超时的测试数量
2. **详细结果**：每个测试的详细信息，包括：
   - 状态（通过/失败/超时）
   - 持续时间
   - 完整的日志输出

## 测试类型说明

### 基本功能测试

测试文件系统的基本操作，包括：
- 文件创建、读取、写入和删除
- 目录操作
- 文件权限

### 内存映射测试

测试文件系统的内存映射功能，包括：
- 基本内存映射和读写
- 多次映射/解除映射循环
- 边界条件测试

### 并发测试

测试文件系统在并发访问下的行为，包括：
- 多进程同时访问
- 多线程同时访问
- 混合读写操作

### 性能测试

测量文件系统的性能特性，包括：
- 顺序读写吞吐量
- 随机读写IOPS
- 内存映射操作性能
- 不同文件大小的性能比较

## 故障排除

如果测试过程中遇到系统崩溃或其他问题：

1. 检查内核日志：`dmesg | tail -n 100`
2. 查看测试日志：`cat test_reports/test_run_*.log`
3. 尝试使用更安全的测试选项：`sudo ./safe_test.sh`

## 注意事项

- 所有测试脚本都需要以root权限运行
- 性能测试结果可能因系统负载而异
- 如果系统崩溃，可能需要重启后才能继续测试
- 测试前确保挂载点（默认为`/mnt/tfs_test`）可用

## 自定义测试

如需自定义测试参数，可以编辑相应的测试脚本。主要可定制参数包括：

- 挂载点路径
- 测试文件大小
- 迭代次数
- 超时设置

## 贡献

欢迎提交问题报告和改进建议。请确保在提交前已运行测试套件并提供详细的测试报告。